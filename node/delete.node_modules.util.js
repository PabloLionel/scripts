const fs = require('fs');
const path = require('path');
const glob = require('glob');

function eliminarDirectoriosPorNombre(directoryName) {
  return function eliminarDirectorio(dir) {
    // Lee el contenido del directorio
    fs.readdir(dir, (err, files) => {
      if (err) {
        console.error(`Error al leer el directorio ${dir}: ${err}`);
        return;
      }

      // Recorre los archivos y directorios
      files.forEach(file => {
        if ([
          'automove-mouse',
          'ly-form',
          'trew-app',
          'ts-playground',
          'typeorm-with-sqlite'
        ].includes(file)) {
          return;
        }

        const filePath = path.join(dir, file);

        // Si es un directorio, llama recursivamente a la funciÃ³n
        if (fs.statSync(filePath).isDirectory()) {
          if (file === directoryName) {
            console.log(`Eliminando la carpeta ${filePath}...`);

            fs.rmdirSync(`./${filePath}`, { recursive: true, force: true });
          } else {
            eliminarDirectoriosPorNombre(directoryName)(filePath);
          }
        }
      });
    });
  }
}

function recorrerArcivosProPathLink(fn) {
  return function(reNombreDeArchivo) {
    glob(
      reNombreDeArchivo,
      {
        ignore: './node_modules/**'
      },
      (err, files) => {

        if (err) {
          console.error(`Error al leer el directorio ${dir}: ${err}`);
          return;
        }

        files.forEach(fn);
      });
  }
}

const listarArchivos = recorrerArcivosProPathLink(path => console.log(path))
const eliminarArchivosPorPathLink = recorrerArcivosProPathLink(path => {
  fs.rmdirSync(path, { recursive: true, force: true });
})
// Directorio inicial
const directorioInicial = '.';

// const eliminarNodeModules = eliminarDirectoriosPorNombre('node_modules');
// const eliminarAngularFolders = eliminarDirectoriosPorNombre('*.spec.ts');

const reNombreDeArchivo = './**/*.spec.ts';

// console.log(`ðŸš€ ~ reNombreDeArchivo:`, reNombreDeArchivo);

// listarArchivos(reNombreDeArchivo);
eliminarArchivosPorPathLink(reNombreDeArchivo);

// eliminarNodeModules(directorioInicial);
// eliminarAngularFolders(directorioInicial);
